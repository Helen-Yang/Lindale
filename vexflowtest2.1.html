<!DOCTYPE html>
<html>
<head>
	<title>Vexflow Test 2</title>
  <script src="http://www.vexflow.com/support/vexflow-debug.js"></script>
  <script src="www.vexflow.com/support/vexflow-min.js"></script>
  <script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>

</head>
<body onclick="drawNotes()">
<p>click for sheet music!</p>
<div class="description staff">
	<canvas width=525 height=200></canvas>

	<script>
		//when note changes, run draw, change counter
		//start/stop button
		var music = ["C/4", "C#/5", "G#/6", "G/4", "A/2", "A/3", "G/4", "C#/5"];
		//================================================================================================================================
		//decides whether to use treble or bass clef
		var clef = function(){
			//variables that count the number of notes that should be using bass clef and treble clef
			var bassClef = 0;
			var trebleClef = 0; 
			//get the octaves
			for (var i = 0; i < music.length; i++){
				//get the octave from the string note, make it into an integer
				var octave = parseInt(music[i].substring(music[i].length-1));
				//if the octave is less than or equal to 3, then it should be using bass clef, otherwise it should be using treble clef
				if(octave <= 3){
					bassClef ++;
				} else {
					trebleClef ++;
				}
			}
			//check if more notes are in the bass clef range or treble clef range, return clef so that in drawNotes the correct clef will be created
			console.log(bassClef, trebleClef);
			if (bassClef > trebleClef){
				return "bass";
			} else {
				return "treble";
			}
		};


		//================================================================================================================================

		//draws the notes on the canvas
		var drawNotes = function () {
			
			var canvas = $("div.staff canvas")[0];
			var renderer = new Vex.Flow.Renderer(canvas, Vex.Flow.Renderer.Backends.CANVAS);
			var ctx = renderer.getContext();
			var stave = new Vex.Flow.Stave(10, 0, 500);
			stave.addClef(clef()).setContext(ctx).draw();
			var plum = [];
			var notes = [];
			for(var i = 0; i<music.length; i++){
				if (music[i].substring(1,2)==="#"){
					music[i] = music[i].substring(0,1)+ music[i].substring(2);
					var apple = new Vex.Flow.StaveNote({keys:[music[i]], duration:"q"}).addAccidental(0, new Vex.Flow.Accidental("#"));
				} else {
				var apple = new Vex.Flow.StaveNote({keys: [music[i]], duration: "q"});
				
				}
				plum.push(apple);
				
			}

			
			for (var num = 0; num < plum.length; num++) {
				notes.push(plum[num]);
			};
			
			// notes = [
			// 	// plum[0],
			// 	// plum[1],

			// 	// new Vex.Flow.StaveNote({keys: ["c/4"], duration: "q"}), 
			// 	// new Vex.Flow.StaveNote({keys: ["d/4"], duration: "q"}),
			// 	// new Vex.Flow.StaveNote({keys: [note[0]], duration: "q"}),

			// ];
			var voice = new Vex.Flow.Voice({
				num_beats: plum.length, 
				beat_value: 4,
				resolution: Vex.Flow.RESOLUTION
			});
			voice.addTickables(notes);

			var formatter = new Vex.Flow.Formatter().joinVoices([voice]).format([voice], 500);

			voice.draw(ctx, stave);
		};//end of draw function
	</script>
</div>
</body>
</html>